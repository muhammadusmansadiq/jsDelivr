"use strict";var RemovalUpload={isFormValid:!0,progressInterval:null,key:'',uiq:'',timeoutLoading:null};(function($){RemovalUpload.initUpload=function(){const upload=document.getElementById('rm_upload_file');if(typeof upload!='undefined'&&upload!=null){upload.addEventListener('change',function(evt){const files=[...evt.target.files];var isValid=RemovalUpload.validateFile($('.rm-upload-content .rst-form-group-drag'),files);if(isValid==1){RemovalUpload.processUpload(files)}},!1)}
const ct_upload=document.getElementById('rm_ct_upload_file');if(typeof ct_upload!='undefined'&&ct_upload!=null){ct_upload.addEventListener('change',function(evt){const files=[...evt.target.files];var isValid=RemovalUpload.validateFile($('.rm-upload-process-top .rst-form-group-drag'),files);if(isValid==1){RemovalUpload.processUpload(files)}},!1)}
RemovalUpload.key=window.location.host.split('.')[0];RemovalUpload.uiq=window.location.host.split('.')[1];const free_upload=document.getElementById('rm_free_upload_file');if(typeof free_upload!='undefined'&&free_upload!=null){free_upload.addEventListener('change',function(evt){const files=[...evt.target.files];var isValid=RemovalUpload.validateFile($('.rm-upload-content .rst-form-group-drag'),files);if(isValid==1){RemovalUpload.processFreeUpload(files)}},!1)}};RemovalUpload.initDragDrop=function(){$("html").on("dragover drop dragenter dragleave dragexit",function(e){e.preventDefault();e.stopPropagation()});$("html").on("dragenter",function(e){$('.drop-image-wrapper').css('display','flex')});$("html").on("dragexit",function(e){$('.drop-image-wrapper').css('display','none')});$(".drop-image-wrapper").on("dragleave dragend",function(e){e.preventDefault();e.stopPropagation();$('.drop-image-wrapper').css('display','none')});$('.drop-image-wrapper').on('drop',function(e){e.stopPropagation();e.preventDefault();$('.drop-image-wrapper').css('display','none');const files=e.originalEvent.dataTransfer.files;var isValid=RemovalUpload.validateFile($(this),files[0]);if(isValid==1){if(window.location.href.includes('upload')){RemovalUpload.processUpload([files[0]])}else{RemovalUpload.processFreeUpload([files[0]])}}})};RemovalUpload.validateFile=function($elm_upload,file){var types=['image/jpeg','image/jpg','image/png'];if(file.length==0||file.size<0){return-1}
if(typeof file.type!='undefined'&&types.indexOf(file.type)<0){$('.rm-upload-message',$elm_upload).html(RemovalMain.data.file_type_invalid).removeClass('rm-hidden');return-1}
if(typeof file.size!='undefined'&&file.size>parseInt(RemovalMain.data.max_size)){$('.rm-upload-message',$elm_upload).html(RemovalMain.data.over_file_size).removeClass('rm-hidden');return-1}
$('.rm-upload-message',$elm_upload).addClass('rm-hidden');return 1};RemovalUpload.processUpload=function(files){var container=$('.rm-upload-container'),template=wp.template('rm-result-item-template'),item=$(template([])),width=6000,height=6000;$('.rm-upload-content',container).fadeOut(function(){$('.rm-upload-process-content',container).removeClass('rm-hidden').fadeIn(function(){$('.rm-upload-process-bottom-inner').prepend(item);$('.ui.progress',item).progress();new Compressor(files[0],{quality:0.9,maxWidth:width,maxHeight:height,success(compressedFile){var reader=new FileReader();reader.readAsDataURL(compressedFile);reader.onloadend=function(){var base64data=reader.result;var base64=base64data.split(',')[1];$('.img-origin img',item).attr("src",base64data);RemovalUpload.timeoutLoading=setTimeout(function(){$('.img-origin img',item).addClass("rm-hidden");$('.img-origin .rm-bg-loading',item).removeClass("rm-hidden")},2500);RemovalUpload.upload(base64,files[0].name,width,height,item)}}})})})}
RemovalUpload.processFreeUpload=function(files){var width=6000,height=6000;RemovalUpload.showLoading($('.rst-form-group-drag.rst-free'));new Compressor(files[0],{quality:0.9,maxWidth:width,maxHeight:height,success(compressedFile){var reader=new FileReader();reader.readAsDataURL(compressedFile);reader.onloadend=function(){var base64data=reader.result;var base64=base64data.split(',')[1];var prefix=base64data.split(',')[0];var url=$('.rm-upload-content.rm-upload-free').attr('data-url');var frm='<form id="frm_free_upload_data" style="display: none" action="'+url+'" method="POST">'+'<input type="hidden" id="hf_free_file" name="hf_free_file" value="'+base64+'" >'+'<input type="hidden" id="hf_free_file_name" name="hf_free_file_name" value="'+files[0].name+'" >'+'<input type="hidden" id="hf_file_prefix" name="hf_file_prefix" value="'+prefix+'" >'+'<input type="hidden" id="hf_width" name="hf_width" value="'+width+'">'+'<input type="hidden" id="hf_height" name="hf_height" value="'+height+'">'+'</form>';$(frm).appendTo('body').submit()}}})};RemovalUpload.processBase64Upload=function(base64Data){var width=6000,height=6000,url=$('.rm-upload-content.rm-upload-free').attr('data-url'),base64=base64Data.split(',')[1],prefix=base64Data.split(',')[0];if(window.location.href.includes('upload')){var container=$('.rm-upload-container'),template=wp.template('rm-result-item-template'),item=$(template([]));$('.rm-upload-content',container).fadeOut(function(){$('.rm-upload-process-content',container).removeClass('rm-hidden').fadeIn(function(){$('.rm-upload-process-bottom-inner').prepend(item);$('.ui.progress',item).progress();$('.img-origin img',item).attr('src',base64Data);RemovalUpload.timeoutLoading=setTimeout(function(){$('.img-origin img',item).addClass("rm-hidden");$('.img-origin .rm-bg-loading',item).removeClass("rm-hidden")},2500);RemovalUpload.upload(base64,'try-demo',width,height,item)})})}else{var frm='<form id="frm_free_upload_data" style="display: none" action="'+url+'" method="POST">'+'<input type="hidden" id="hf_free_file" name="hf_free_file" value="'+base64+'" >'+'<input type="hidden" id="hf_free_file_name" name="hf_free_file_name" value="try-demo" >'+'<input type="hidden" id="hf_file_prefix" name="hf_file_prefix" value="'+prefix+'" >'+'<input type="hidden" id="hf_width" name="hf_width" value="'+width+'">'+'<input type="hidden" id="hf_height" name="hf_height" value="'+height+'">'+'</form>';$(frm).appendTo('body').submit()}}
RemovalUpload.uploadFromUrl=function(){let imageURL=prompt("Please enter image URL");RemovalUpload.processTryUpload(imageURL)}
RemovalUpload.uploadFromClipBoard=function(){window.addEventListener("paste",function(pasteEvent){if(pasteEvent.clipboardData==!1){throw("No data")};var items=pasteEvent.clipboardData.items;if(items==undefined){throw("No data")};for(var i=0;i<items.length;i++){if(items[i].type.indexOf("image")==-1)continue;var blob=items[i].getAsFile();var mycanvas=document.createElement("canvas");var ctx=mycanvas.getContext('2d');var img=new Image();img.onload=function(){if(this.width>9000||this.height>9000){alert("Error: Image too large!")
throw("No data")}
mycanvas.width=this.width;mycanvas.height=this.height;ctx.drawImage(img,0,0);let imageBase64=mycanvas.toDataURL("image/jpeg",0.8);RemovalUpload.processBase64Upload(imageBase64)};var URLObj=window.URL||window.webkitURL;img.src=URLObj.createObjectURL(blob)}},!1)}
RemovalUpload.processTryUpload=function(url){var img=new Image();img.crossOrigin="anonymous";img.onload=function(){const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);const dataUrl=canvas.toDataURL('image/jpeg',0.8);var width=$('body').hasClass('logged-in')?6000:1600,height=$('body').hasClass('logged-in')?6000:1600,url=$('.rm-upload-content.rm-upload-free').attr('data-url'),base64=dataUrl.split(',')[1],prefix=dataUrl.split(',')[0];var frm='<form id="frm_free_upload_data" style="display: none" action="'+url+'" method="POST">'+'<input type="hidden" id="hf_free_file" name="hf_free_file" value="'+base64+'" >'+'<input type="hidden" id="hf_free_file_name" name="hf_free_file_name" value="try-demo" >'+'<input type="hidden" id="hf_file_prefix" name="hf_file_prefix" value="'+prefix+'" >'+'<input type="hidden" id="hf_width" name="hf_width" value="'+width+'">'+'<input type="hidden" id="hf_height" name="hf_height" value="'+height+'">'+'</form>';$(frm).appendTo('body').submit()};img.src=url;img.onerror=function(){alert("Cannot load your image url, please try again with upload image!")}};RemovalUpload.upload=function($data_base64,name,width,height,item){if(window.innerWidth>754){RemovalUpload.setLayoutDimentions($data_base64,item)}
const upload_result_offset=$("#rm-upload-result").offset();const offset_reponsive=$(window).width()>768?80:20;$('html, body').animate({scrollTop:upload_result_offset.top-offset_reponsive,},600);RemovalUpload.progressInterval=setInterval(function(){var percent=$('.ui.progress',item).attr('data-percent');percent=parseInt(percent);if(percent<80){$('.ui.progress',item).progress('increment',3)}else{clearInterval(RemovalUpload.progressInterval)}},100);var d=new Date(jQuery.now()),now=d.getDate()+"-"+(d.getMonth()+1)+"-"+d.getFullYear()+" "+d.getHours()+":"+d.getMinutes();var key=RemovalUpload.key+';'+now;$.ajax({url:RemovalMain.data.ajax_url,type:'POST',data:({action:'rm_upload',file:$data_base64,name:name,key:btoa(key),uiq:btoa(RemovalUpload.uiq),token:btoa('5a6645a44b1440b89eb70ff096b2a756'),s_field:RemovalMain.data.ajax_s_field}),success:function(response){response=$.parseJSON(response);clearTimeout(RemovalUpload.timeoutLoading);$('.ui.progress',item).progress('increment',80);$('.img-origin',item).removeClass('loading');$('.img-origin img',item).removeClass("rm-hidden");$('.img-origin .rm-bg-loading',item).remove();if(response.result>0){if(!response.preview_demo){$('.rm-remove-error',item).removeClass('rm-hidden');$('.rm-bg-result',item).addClass('rm-hidden');$('.rm-upload-control',item).html('');$('a[href="#removed-image"]',item).addClass('rm-error');$('a[href="#removed-image"]',item).trigger('click')}else{$('.rme-button',item).show();$('.rme-image.rme-preview',item).attr('data-image',response.url);$('.rmr-image.rmr-preview',item).attr('data-img',response.original_image).attr('data-res',response.url);$('.rmr-image.rmr-high-res',item).attr('data-img',response.original_image);var imageResultElement=$('<img src = "'+response.preview_demo+'">'),preloaded=0,total=imageResultElement.length;imageResultElement.hide();imageResultElement.on("load",function(){if(++preloaded===total){$('.ui.progress',item).progress('increment',100);$('.rm-bg-result',item).html(imageResultElement);imageResultElement.show()}});$('a.rm-bt-download:not(.rm-bt-high-res)',item).removeClass('rm-disable').attr('href',response.url);$('.rmem-image',item).attr('data-image',response.url);$('a[href="#removed-image"]',item).trigger('click');$('.rm-skeleton-group',item).addClass('rm-hidden');$('.rm-button-group',item).removeClass('rm-hidden');$('.img-origin',item).removeClass('loading');$('.rm-free-download-dimention span',item).html(`${response.preview_width} x ${response.preview_height}`);$('.rm-high-download-dimention span',item).html(`${response.original_width} x ${response.original_height}`);$('.preview-dimentions',item).html(`${response.preview_width} x ${response.preview_height}`);$('.full-dimentions',item).html(`${response.original_width} x ${response.original_height}`);if(typeof response.high_resolution&&response.high_resolution!=''){$('.rme-image.rme-high-res',item).attr('data-image',response.high_resolution);$(".rme-before.rme-high-res",item).on('click',function(e){e.preventDefault();$(".rme-image.rme-high-res",item).click()})
$('.rmr-image.rmr-high-res',item).attr('data-img',response.original_image).attr('data-res',response.high_resolution);$(".rmr-before.rmr-high-res",item).on('click',function(e){e.preventDefault();$(".rmr-image.rmr-high-res",item).click()});$('.rm-download-high-res',item).removeClass('rm-hidden');$('a.rm-bt-download.rm-bt-high-res',item).attr('href',response.high_resolution)}else{if(typeof response.preview_id!='undefined'&&response.preview_id!=''){if(typeof response.total_credit!='undefined'&&parseInt(response.total_credit)>0){$('.rm-download-high-res',item).removeClass('rm-hidden').show();RemovalUpload.getHighResolution(response.preview_id,$('a.rm-bt-download.rm-bt-high-res',item),$('.rme-before.rme-high-res',item),$('.rmr-before.rmr-high-res',item))}else{$('.rm-download-high-res',item).removeClass('rm-hidden');$('a.rm-bt-download.rm-bt-high-res',item).removeAttr('download');$('a.rm-bt-download.rm-bt-high-res',item).click(function(e){e.preventDefault();window.location.href=$('a.rm-bt-download.rm-bt-high-res',item).data("pricing-url")});$('.rme-before.rme-high-res',item).click(function(e){e.preventDefault();window.location.href=$('a.rm-bt-download.rm-bt-high-res',item).data("pricing-url")});$('.rmr-before.rmr-high-res',item).click(function(e){e.preventDefault();window.location.href=$('a.rm-bt-download.rm-bt-high-res',item).data("pricing-url")})}}else{$('.rm-download-high-res',item).hide()}}}}else{$('a[href="#removed-image"]',item).addClass('rm-error');$('a[href="#removed-image"]',item).trigger('click');$('.rm-upload-control',item).html('');$('.rm-bg-result',item).addClass('rm-hidden');if(typeof response.message!='undefined'){if(response.message=="out_of_credit"){$(".rm-out-of-credit-error",item).removeClass('rm-hidden')}else if(response.message=="end_of_trial_credits"){$(".rm-end-of-trial-credit-error",item).removeClass('rm-hidden')}else{$('.rm-upload-message',item).html(response.message).removeClass('rm-hidden')}}else{$('.rm-upload-message',item).html(RemovalMain.data.error_message).removeClass('rm-hidden')}}},error:function(){$('a[href="#removed-image"]',item).addClass('rm-error');$('a[href="#removed-image"]',item).trigger('click');$('.rm-upload-message').html(RemovalMain.data.error_message).removeClass('rm-hidden')}})};RemovalUpload.getHighResolution=function($pci_id,...elms){elms.map(elm=>{elm.on('click',function(event){event.preventDefault();let targetClick=$(event.target);let virtualEditButton=elm.parents(".rm-result-item").find(".rme-image.rme-high-res");let virtualEraserButton=elm.parents(".rm-result-item").find(".rmr-image.rmr-high-res");if(virtualEditButton&&virtualEditButton.attr("data-image")&&targetClick.hasClass("rme-high-res")){virtualEditButton.click()}else if(virtualEraserButton&&virtualEraserButton.attr("data-res")&&targetClick.hasClass("rmr-high-res")){virtualEraserButton.click()}else{elm.addClass('loading');$.ajax({url:RemovalMain.data.ajax_url,type:'POST',data:({action:'rm_get_high_resolution',pci_id:$pci_id,s_field:RemovalMain.data.ajax_s_field}),success:function(response){response=$.parseJSON(response);if(typeof response.result!='undefined'&&response.result==1){elm.removeClass('loading');virtualEditButton.attr("data-image",response.high_resolution);virtualEraserButton.attr("data-res",response.high_resolution);if(elm.hasClass("rm-bt-download")){elm.attr("href",response.high_resolution);elm.off('click');window.open(response.high_resolution,'_blank')}else{let downloadButton=elm.parents(".rm-result-item").find(".rm-bt-high-res.rm-bt-download");downloadButton.attr("href",response.high_resolution);downloadButton.off('click');if(elm.hasClass("rme-before")){virtualEditButton.click()}
if(elm.hasClass("rmr-before")){virtualEraserButton.click()}}}},error:function(){}})}
return!1})})};RemovalUpload.initFreeUpload=function(){var freeContainer=$('.rm-free-upload-content');if(typeof freeContainer!='undefined'&&freeContainer.length>0){var data=$('#hf_free_file',freeContainer).text(),file_name=$('#hf_free_file_name',freeContainer).val(),prefix=$('#hf_file_prefix',freeContainer).val(),width=$('#hf_width',freeContainer).val(),height=$('#hf_height',freeContainer).val();if(data!=''){var container=$('.rm-upload-container'),template=wp.template('rm-result-item-template'),item=$(template([]));if(window.history.replaceState){window.history.replaceState(null,null,window.location.href)}
$('.rm-upload-content',container).hide();$('.rm-upload-process-content',container).removeClass('rm-hidden');$('.rm-upload-process-bottom-inner').prepend(item);$('.ui.progress',item).progress();$('.img-origin img',item).attr('src',prefix+","+data);RemovalUpload.timeoutLoading=setTimeout(function(){$('.img-origin img',item).addClass("rm-hidden");$('.img-origin .rm-bg-loading',item).removeClass("rm-hidden")},2500);RemovalUpload.upload(data,file_name,width,height,item);$('.rm-free-upload-content').remove()}}};RemovalUpload.showLoading=function(container){var loading="<div class=\"fat-sb-loading-container\"><div class=\"ui segment\">\n"+"  <div class=\"ui active dimmer\">\n"+"    <div class=\"ui small text loader\">Processing ...</div>\n"+"  </div>\n"+"  <p></p>\n"+"</div></div>";$(container).append(loading)};RemovalUpload.initTab=function(){$(document).on("click","a[data-toggle=rm-tab]",function(e){e.preventDefault();$(this).parents(".nav-tabs").find('li.active').removeClass('active');$(this).parent().addClass('active');const targetId=$(this).attr("href");const targetParrent=$(this).parents(".rm-result-item");targetParrent.find(".tab-pane.active").removeClass('active');targetParrent.find(targetId).addClass('active')})}
RemovalUpload.initRateResult=function(template){$(".rm-result-rating input",template).click(function(e){console.log($(this).val())})}
RemovalUpload.addItemToStorage=function(item){if(!item){throw new("Error: 1101")}
item.date=new Date();let removedData=localStorage.getItem("hello-removal")&&JSON.parse(localStorage.getItem("hello-removal"))||[];removedData.push(item);localStorage.setItem("hello-removal",JSON.stringify(removedData))}
RemovalUpload.downloadHighresItem=function(preview_id,high_resolution){let currentData=localStorage.getItem("hello-removal")&&JSON.parse(localStorage.getItem("hello-removal"))||[];if(currentData.length<1){throw new("Error: 1102")}
let indexUpdate=currentData.findIndex(i=>i.preview_id==preview_id);if(!indexUpdate){throw new("Error: 1103")}
currentData[indexUpdate].high_resolution=high_resolution;localStorage.setItem("hello-removal",JSON.stringify(currentData))}
RemovalUpload.initRemovedFromStorage=function(){if(!window.location.pathname.includes("upload")){return}
let currentData=localStorage.getItem("hello-removal")&&JSON.parse(localStorage.getItem("hello-removal"))||[];let timeCompare=new Date();timeCompare.setMinutes(timeCompare.getMinutes()-50);currentData=currentData.filter(i=>new Date(i.date)>timeCompare);if(currentData.length>0){currentData.map(response=>{var container=$('.rm-upload-container'),template=wp.template('rm-result-item-template'),item=$(template([]));$('.rm-upload-content',container).hide();$('.rm-upload-process-content',container).removeClass('rm-hidden');$('.rm-upload-process-bottom-inner').prepend(item);$('.rm-loading-origin',item).remove();$('.img-origin img',item).attr("src",response.original_image);$('.rme-button',item).show();$('.rme-image.rme-preview',item).attr('data-image',response.url);var imageResultElement=$('<img src = "'+response.preview_demo+'">'),preloaded=0,total=imageResultElement.length;imageResultElement.hide();imageResultElement.on("load",function(){if(++preloaded===total){$('.ui.progress',item).progress('increment',100);$('.rm-bg-result',item).html(imageResultElement);imageResultElement.show()}});$('a.rm-bt-download:not(.rm-bt-high-res)',item).removeClass('rm-disable').attr('href',response.url);$('a[href="#removed-image"]',item).trigger('click');$('.rm-skeleton-group',item).addClass('rm-hidden');$('.rm-button-group',item).removeClass('rm-hidden');$('.img-origin',item).removeClass('loading');$('.rm-free-download-dimention span',item).html(`${response.preview_width} x ${response.preview_height}`);$('.rm-high-download-dimention span',item).html(`${response.original_width} x ${response.original_height}`);if(typeof response.high_resolution&&response.high_resolution!=''){$('.rme-image.rme-high-res',item).attr('data-image',response.high_resolution);$(".rme-before.rme-high-res",item).on('click',function(e){e.preventDefault();$(".rme-image.rme-high-res",item).click()})
$('.rm-download-high-res',item).removeClass('rm-hidden');$('a.rm-bt-download.rm-bt-high-res',item).attr('href',response.high_resolution)}else{if(typeof response.preview_id!='undefined'&&response.preview_id!=''){if(typeof response.total_credit!='undefined'&&parseInt(response.total_credit)>0){$('.rm-download-high-res',item).removeClass('rm-hidden').show();RemovalUpload.getHighResolution(response.preview_id,$('a.rm-bt-download.rm-bt-high-res',item),$('.rme-before.rme-high-res',item))}else{$('.rm-download-high-res',item).removeClass('rm-hidden');$('a.rm-bt-download.rm-bt-high-res',item).removeAttr('download');$('a.rm-bt-download.rm-bt-high-res',item).click(function(e){e.preventDefault();window.location.href=$('a.rm-bt-download.rm-bt-high-res',item).data("pricing-url")})}}else{$('.rm-download-high-res',item).hide()}}})}}
RemovalUpload.setLayoutDimentions=function(base64data,item){var image=new Image();image.src="data:image/jpeg;base64,"+base64data;image.onload=function(){var maxImageHeightDisplay=image.height>514?514:480;var newImageWidth=image.height>514?maxImageHeightDisplay*image.width/image.height:image.width;$(".rm-upload-result",item).css("width",newImageWidth);$(".rm-upload-result",item).css("height",maxImageHeightDisplay)}}
$(document).ready(function(){RemovalUpload.initDragDrop();RemovalUpload.initUpload();RemovalUpload.initFreeUpload();RemovalUpload.uploadFromClipBoard();RemovalUpload.initTab();$(document).on('click',"button.x-button-drop",function(){if(!$(this).parents('.x-split-button').hasClass('open'))
$(this).parents('.x-split-button').addClass('open')});$(document).on('click',".x-split-button",function(event){event.stopPropagation()});$(document).on('click',function(){if($('.x-split-button').hasClass('open'))
$('.x-split-button').removeClass('open')});$(document).on('click','#needOneCreditClose',function(){$("#needOneCredit").addClass("is-hidden")})})})(jQuery);
